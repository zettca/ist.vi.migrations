(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{103:function(t,e,n){t.exports=n(203)},175:function(t,e,n){},199:function(t,e,n){},201:function(t,e,n){},203:function(t,e,n){"use strict";n.r(e);var r=n(40),a=n(9),o=n.n(a),c=n(1),i=n.n(c),u=n(6),l=n.n(u),s=n(20),d=n(16),f=n(24),p=n(18),h=n(17),v=n(19),g=n(101),m=n(4),b=n(98),y=new(function(t){function e(){return Object(d.a)(this,e),Object(p.a)(this,Object(h.a)(e).apply(this,arguments))}return Object(v.a)(e,t),e}(n.n(b).a)),C=[1995,2e3,2005,2010,2015,2017];var j={map:m.s[9],selection:m.t.slice(2)},O={getCountries:x,setCountries:k,clearCountries:function(){k([])},addCountry:function(t){var e=new Set(x());e.add(t),k(e)},remCountry:function(t){var e=new Set(x());e.delete(t),k(e)},getYear:function(){return o.a.get("year")},setYear:function(t){o.a.set("year",t),y.emit("yearChanged")},getMigration:function(){return o.a.get("isEmigration")},setMigration:function(t){o.a.set("isEmigration",t),y.emit("migrationChanged")}};function x(){return o.a.get("selectedCountries")}function k(t){o.a.set("selectedCountries",Array.from(t)),y.emit("countriesChanged")}function w(t,e){return o.a.get("isEmigration")?t.WORLD[e]:t[e].Total}function A(t){return o.a.get("codeToName")[t]}function E(t){var e={};for(var n in t){var r=Number(t[n]);isNaN(r)||0===r||(e[n]=r)}return e}function S(t){return document.getElementById(t)}function R(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{width:400,height:400},n=arguments.length>2?arguments[2]:void 0,r=m.u(t).append("svg").attr("width",e.width).attr("height",e.height);return void 0!==n?r.append("g").attr("class","main").attr("transform","translate(".concat(n.left||0,",").concat(n.top||0,")")):r}n(173),n(175);var N={};function F(t){O.setYear(t)}C.forEach(function(t){return N[t]=t+""});var I=function(t){function e(t){var n;return Object(d.a)(this,e),(n=Object(p.a)(this,Object(h.a)(e).call(this,t))).state={},n}return Object(v.a)(e,t),Object(f.a)(e,[{key:"componentDidMount",value:function(){var t=this;y.on("yearChanged",function(){var e=O.getYear();t.setState({year:e})})}},{key:"render",value:function(){return i.a.createElement("div",{style:{padding:"0.4em 2em 0"}},i.a.createElement(g.a,{value:this.state.year,min:1995,max:2017,included:!1,marks:N,step:null,onChange:F,defaultValue:2010,handleStyle:{border:"white",backgroundColor:"silver"}}))}}]),e}(i.a.Component),T=n(36),B=n(49),D=n(51),M=n.n(D),H=function(t){function e(){return Object(d.a)(this,e),Object(p.a)(this,Object(h.a)(e).apply(this,arguments))}return Object(v.a)(e,t),Object(f.a)(e,[{key:"render",value:function(){var t=this.props.events,e=[];return t.forEach(function(t,n){var r=t.year,a=t.name;e.push({value:n,label:"".concat(r," ").concat(a)})}),i.a.createElement(B.a,Object.assign({onChange:function(e,n){for(var r=t[e.value],a=r.name,o=r.year,c=r.countries.split(","),i=0;C[i]<o;)i++;var u=C[i-1]||C[0];console.log("EVENT:",u,a,c),O.setCountries(c),O.setYear(u)},placeholder:"Select an event...",components:M.a,onBlurResetsInput:!1,onSelectResetsInput:!1,onCloseResetsInput:!1,options:e,theme:function(t){return Object(T.a)({},t,{borderRadius:0,colors:Object(T.a)({},t.colors,{neutral0:"#333",neutral5:"orange",neutral10:"#666",neutral20:"#666",primary25:"#666",neutral50:"#eee",neutral80:"white"})})}},this.props))}}]),e}(i.a.PureComponent),P=o.a.get("codeToName");function W(t,e){switch(console.log(t,e),e.action){case"clear":return O.clearCountries();case"select-option":return O.addCountry(e.option.value);case"remove-value":return O.remCountry(e.removedValue.value)}}var Y,q,V,G,J,L=function(t){function e(t){var n;return Object(d.a)(this,e),(n=Object(p.a)(this,Object(h.a)(e).call(this,t))).state={},n}return Object(v.a)(e,t),Object(f.a)(e,[{key:"componentDidMount",value:function(){var t=this;y.on("countriesChanged",function(){var e=O.getCountries().map(function(t){return{value:t,label:P[t]}});t.setState({value:e})})}},{key:"render",value:function(){console.log(this.state);var t=this.props.data,e=[],n=Object.keys(t).slice(-1);Object.keys(t[n]).forEach(function(t){3===t.length&&e.push({value:t,label:P[t]})});var r=e.sort(function(t,e){return t.label<e.label?-1:1});return i.a.createElement(B.a,Object.assign({isMulti:!0,placeholder:"Select countries...",components:M.a,onBlurResetsInput:!1,onSelectResetsInput:!1,onCloseResetsInput:!1,options:r,value:this.state.value,theme:function(t){return Object(T.a)({},t,{borderRadius:0,colors:Object(T.a)({},t.colors,{neutral0:"#333",neutral5:"orange",neutral10:"#666",neutral20:"#666",primary25:"#666",neutral50:"#eee",neutral80:"white"})})},onChange:W},this.props))}}]),e}(i.a.Component),z=n(39),K=n(100),U=n.n(K),Q=function(t){function e(t){var n;return Object(d.a)(this,e),(n=Object(p.a)(this,Object(h.a)(e).call(this,t))).state={checked:!1},n.handleChange=n.handleChange.bind(Object(z.a)(Object(z.a)(n))),n}return Object(v.a)(e,t),Object(f.a)(e,[{key:"componentDidMount",value:function(){var t=this.state.checked;o.a.set("isEmigration",t)}},{key:"handleChange",value:function(t){this.setState({checked:t}),O.setMigration(t)}},{key:"render",value:function(){var t=this.state.checked;return i.a.createElement("div",null,i.a.createElement(U.a,{onChange:this.handleChange,checked:t,onColor:"#FFAB91",offColor:"#FFAB91",onHandleColor:"#FF8A65",offHandleColor:"#FF8A65",handleDiameter:24,uncheckedIcon:!1,checkedIcon:!1,boxShadow:"0px 1px 5px rgba(0, 0, 0, 0.6)",activeBoxShadow:"0px 0px 1px 10px rgba(0, 0, 0, 0.2)",height:16,width:64,id:"mySwitcherino"}),i.a.createElement("span",null,t?"Emigration":"Immigration"))}}]),e}(i.a.Component),X={draw:function(t,e){var n=document.querySelector(t),r=[n.clientWidth,n.clientHeight],a=r[0],o=r[1];Y=R(t,{width:a,height:o}),G=.5*Math.min(a,o),J=G-20,V=e,Y.attr("viewBox",[-a/2,-o/2,a,o]),Y.append("g").attr("class","nodes"),Y.append("g").attr("class","arcs"),$()},update:$};function Z(){q=o.a.get("selectedCountries");var t=o.a.get("isEmigration"),e=o.a.get("year")||2010,n=[];return q.forEach(function(r){n.push(q.map(function(n){return function(n,r){var a;try{a=t?V[e][r][n]:V[e][n][r]}catch(o){a=0}return a||0}(r,n)}))}),n}function $(){console.log("updating chord...");var t=Y.select(".nodes"),e=Y.select(".arcs");t.selectAll(".node").remove(),e.selectAll(".arc").remove();var n=m.d().padAngle(.02)(Z()),a=m.o().radius(J),c=m.q().domain(m.n(j.selection.length)).range(j.selection),i=m.a().innerRadius(J).outerRadius(G);0!==n.length&&(t.selectAll("g").data(n.groups).enter().append("g").attr("class","node").append("path").attr("fill",function(t,e){return c(e)}).attr("stroke",function(t,e){return c(e)}).attr("d",i).on("mouseover",function(t,n){var r=e.selectAll(".arc");r.classed("fade",function(t){return t.source.index!==n&&t.target.index!==n}),r.classed("show",function(t){return t.source.index===n})}).on("mouseout",function(t,n){e.selectAll(".arc.show").classed("show",!1),e.selectAll(".arc.fade").classed("fade",!1)}).append("title").text(function(t){return"".concat(A(q[t.index]),": ").concat(m.g("~s")(t.value))}),e.selectAll("path").data(n).enter().append("path").attr("class","arc").attr("d",a).attr("fill",function(t){return c(t.target.index)}).append("title").text(function(t){return function(t){var e=o.a.get("isEmigration")?[t.source,t.target]:[t.target,t.source],n=[t.source,t.target],a=e.map(function(t){return A(q[t.index])}),c=Object(r.a)(a,2),i=c[0],u=c[1],l=n.map(function(t){return m.g("~s")(t.value)}),s=Object(r.a)(l,2),d=s[0],f=s[1];return"".concat(i," > ").concat(u,": ").concat(d,"\n").concat(u," > ").concat(i,": ").concat(f)}(t)}))}y.on("yearChanged",function(){return $()}),y.on("countriesChanged",function(){return $()}),y.on("migrationChanged",function(){return $()});var _,tt,et,nt,rt,at,ot={draw:function(t,e,n,r){var a=document.querySelector(t);tt={width:a.clientWidth,height:a.clientHeight},_=R(t,tt,ct),rt=e,at=r,nt=n,lt()},update:lt},ct={top:10,right:20,bottom:20,left:40},it=["GDP per capita","Social support","Healthy life expectancy","Freedom to make life choices","Perceptions of corruption"];function ut(){var t={};return nt.forEach(function(e){void 0===t[e.country]&&(t[e.country]=[]),t[e.country].push(function(t){var e={};for(var n in t){var r=Number(t[n]);e[n]=r||t[n]}return e}(e))}),t}function lt(){console.log("updating graph...");var t=tt.width-ct.left-ct.right,e=tt.height-ct.top-ct.bottom;et=o.a.get("selectedCountries");var n=function(){var t={};if(!et||0===et.length)return[];var e=!0,n=!1,r=void 0;try{for(var a,o=et[Symbol.iterator]();!(e=(a=o.next()).done);e=!0){var c=a.value,i=[];for(var u in rt){var l=rt[u];if(void 0!==l[c]){var s=Number(w(l,c)),d=(at[c][u],s);i.push({year:Number(u),value:Number(d)})}}t[c]=i}}catch(f){n=!0,r=f}finally{try{e||null==o.return||o.return()}finally{if(n)throw r}}return t}(),r=ut(),a=Object.values(n).reduce(function(t,e){return t.concat(e)},[]),c=function(t,e){return[m.m(t,e),m.l(t,e)]},i=m.p().domain(c(a,function(t){return t.year})).nice().range([0,t]),u=m.p().domain(c(a,function(t){return t.value})).nice().range([e,0]),l=it.map(function(t){return m.p().domain(c(nt,function(e){return+e[t]})).nice().range([e,0])}),s=m.b(i).tickFormat(m.g("d")),d=m.c(u).tickFormat(m.g("~s")),f=m.k().x(function(t){return i(t.year)}).y(function(t){return u(t.value)}).curve(m.e);_.selectAll(".country").remove(),_.selectAll(".xAxis").remove(),_.selectAll(".yAxis").remove(),_.append("g").attr("class","xAxis").attr("transform","translate(0,".concat(e,")")).call(s),_.append("g").attr("class","yAxis").call(d);var p=o.a.get("isEmigration")?"emigration":"immigration",h=_.append("g").attr("class","countries");var v=0,g=function(t){var e=n[t],a=j.selection[v++%j.selection.length],o=A(t);if(!e)return"break";var c=h.append("g").attr("id",t).attr("class","country").attr("name",o);if(c.append("path").datum(e).attr("class","line").attr("stroke",a).attr("d",f).on("click",function(){return t=c,h.attr("visibility","hidden"),t.attr("visibility","visible"),t.selectAll(".selected").classed("selected",!1),void t.selectAll(".metrics").classed("selected",!0);var t}).on("contextmenu",function(){return t=c,m.f.preventDefault(),h.attr("visibility","visible"),t.attr("visibility",null),t.selectAll(".selected").classed("selected",!1),void t.selectAll(".metrics").attr("visibility","hidden");var t}).on("mouseenter",function(){return c.selectAll(".metrics").attr("visibility","visible")}).on("mouseout",function(){return c.selectAll(".metrics").attr("visibility","hidden")}).append("title").text(function(){return"".concat(o," ").concat(p," line")}),c.append("g").attr("class","dots").attr("fill",a).attr("stroke",a).selectAll().data(e).enter().append("circle").attr("cx",function(t){return i(t.year)}).attr("cy",function(t){return u(t.value)}).attr("r",3).append("title").text(function(t){return"".concat(o," (").concat(t.year,"): ").concat(m.g("~s")(t.value))}),!r[t])return"break";var s=c.append("g").attr("class","metrics").attr("visibility","hidden");it.forEach(function(e,n){var a=m.j(n/it.length),c=m.k().x(function(t){return i(t.year)}).y(function(t){return l[n](t[e])}).defined(function(t){return t[e]}).curve(m.e),u=s.append("g").attr("class","metric");u.append("path").datum(r[t]).attr("stroke",a).attr("fill","none").attr("opacity",.8).attr("d",c).append("title").text(function(){return e}),u.append("g").attr("fill",a).attr("stroke",a).selectAll("circle").data(r[t]).enter().append("circle").attr("class","circle").attr("cx",function(t){return i(t.year)}).attr("cy",function(t){return l[n](t[e])}).attr("r",function(t){return""===t[e]?0:3}).append("title").text(function(t){return"".concat(o," (").concat(t.year,"): ").concat(t[e]," ").concat(e)})})};for(var b in n){if("break"===g(b))break}}y.on("countriesChanged",function(){return lt()}),y.on("migrationChanged",function(){return lt()});var st,dt,ft,pt={draw:function(t,e,n,r){var a=document.querySelector(t),o=[a.clientWidth,a.clientHeight],c=o[0],i=o[1];st=R(t,{width:c,height:i}),dt=n,ft=r;var u=m.h().scale(c/5).translate([c/2,i/.8]),l=m.i().projection(u),s=m.w().scaleExtent([.6,7]).on("zoom",function(){d.selectAll("path").attr("transform",m.f.transform)});st.call(s);var d=st.append("g").attr("class","countries");d.selectAll("path").data(e.features).enter().append("path").attr("id",function(t){return t.id}).attr("name",function(t){return t.properties.name}).attr("d",l).on("click",mt).on("mouseover",ht).on("mouseout",vt).on("contextmenu",gt).append("title").text(function(t){return"".concat(t.id,": ").concat(t.properties.name)}),bt()},update:bt};function ht(){}function vt(){}function gt(t){m.f.preventDefault(),O.remCountry(t.id)}function mt(t){["UNK","TWN","ATA"].includes(t.id)||O.addCountry(t.id)}function bt(){console.log("updating map...");var t=o.a.get("selectedCountries")||[],e=o.a.get("year")||2010,n=dt[e];function r(t){return void 0===n[t.id]?0:w(n,t.id)/ft[t.id][e]||0}var a=m.r().domain([-20,-10,-5,-2.5,0,2.5,5,10,20]).range(j.map);st.selectAll("path").style("fill",function(t){return a(r(t))}).select("title").text(function(t){return"".concat(A(t.id),": ").concat(m.g(".1f")(r(t)),"/1000 population")}),m.v(".selected").classed("selected",!1),t.forEach(function(t,e){m.u("path#"+t).style("fill",j.selection[e%j.selection.length]).classed("selected",!0)})}y.on("yearChanged",function(){return bt()}),y.on("countriesChanged",function(){return bt()}),y.on("migrationChanged",function(){return bt()});n(199),n(201);o.a.remove("selectedCountries"),o.a.remove("isEmigration"),o.a.set("year",2010),o.a.set("selectedCountries",["PRT"]);var yt=[Object(s.a)("./data/topology.json"),Object(s.a)("./data/migrations.json"),Object(s.b)("./data/conversion.tsv"),Object(s.b)("./data/population.tsv"),Object(s.b)("./data/events.tsv"),Object(s.b)("./data/whr2018.tsv")];Promise.all(yt).then(function(t){return function(t){var e=Object(r.a)(t,6),n=e[0],a=e[1],c=e[2],u=e[3],s=e[4],d=e[5],f=function(t){function e(t,e){var n=t.indexOf(e);return n>0?t[n-1]:t[0]}var n={},r=Object.keys(t);for(var a in t)if(a!==r[0])for(var o in n[a]={},t[a])for(var c in n[a][o]={},t[a][o]){var i=t[a][o],u=t[e(r,a)][o]||{};n[a][o][c]=i[c]-(u[c]||0)}return n}(a),p={},h={},v={};u.forEach(function(t){return h[t.Country]=E(t)}),d.forEach(function(t){return v[t.country]=E(t)}),c.forEach(function(t){return p[t.code3]=t.name}),o.a.set("codeToName",p),pt.draw("#map",n,f,h),ot.draw("#graph",f,d,h),X.draw("#chord",a),l.a.render(i.a.createElement(L,{data:a}),S("countrySelect")),l.a.render(i.a.createElement(H,{events:s}),S("eventList")),l.a.render(i.a.createElement(Q,null),S("migrationSwitch")),l.a.render(i.a.createElement(I,null),S("yearSlider")),O.setCountries(["PRT","FRA","GBR"])}(t)})}},[[103,2,1]]]);
//# sourceMappingURL=main.07af2ebe.chunk.js.map