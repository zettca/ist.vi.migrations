(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{103:function(e,t,n){e.exports=n(200)},173:function(e,t,n){},175:function(e,t,n){},198:function(e,t,n){},199:function(e,t,n){},200:function(e,t,n){"use strict";n.r(t);var r=n(40),a=n(9),o=n.n(a),i=n(1),c=n.n(i),u=n(6),s=n.n(u),l=n(20),d=n(16),f=n(24),m=n(18),v=n(17),p=n(19),h=n(101),g=n(2),b=(n(173),g.u("body").append("div").attr("id","tooltip").style("visibility","hidden"));var y={mouseover:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"tooltip";b.style("visibility","visible"),b.html(e).style("left",g.f.pageX+"px").style("top",g.f.pageY-28+"px")},mouseout:function(){b.style("visibility","hidden")},mousemove:function(){b.style("left",g.f.pageX+10+"px").style("top",g.f.pageY+"px")},tooltip:b},C=n(98),j=new(function(e){function t(){return Object(d.a)(this,t),Object(m.a)(this,Object(v.a)(t).apply(this,arguments))}return Object(p.a)(t,e),t}(n.n(C).a)),O={getCountries:k,setCountries:w,clearCountries:function(){w([])},addCountry:function(e){var t=new Set(k());t.add(e),w(t)},remCountry:function(e){var t=new Set(k());t.delete(e),w(t)},getYear:function(){return o.a.get("year")||2010},setYear:function(e){o.a.set("year",e),j.emit("yearChanged")},getMigration:function(){return o.a.get("isEmigration")||!1},setMigration:function(e){o.a.set("isEmigration",e),j.emit("migrationChanged")}};function k(){return o.a.get("selectedCountries")||[]}function w(e){o.a.set("selectedCountries",Array.from(e)),j.emit("countriesChanged")}var x=[1995,2e3,2005,2010,2015,2017],A=j,E=O;var S={map:g.s[9],selection:g.t.slice(2)};function R(e,t){return o.a.get("isEmigration")?e.WORLD[t]:e[t].Total}function N(e){return o.a.get("codeToName")[e]}function F(e){var t={};for(var n in e){var r=Number(e[n]);isNaN(r)||0===r||(t[n]=r)}return t}function I(e){return document.getElementById(e)}function M(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{width:400,height:400},n=arguments.length>2?arguments[2]:void 0,r=g.u(e).append("svg").attr("width",t.width).attr("height",t.height);return void 0!==n?r.append("g").attr("class","main").attr("transform","translate(".concat(n.left||0,",").concat(n.top||0,")")):r}n(174),n(175);var T={};function Y(e){E.setYear(e)}x.forEach(function(e){return T[e]=e+""});var B=function(e){function t(e){var n;return Object(d.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).state={},n}return Object(p.a)(t,e),Object(f.a)(t,[{key:"componentDidMount",value:function(){var e=this;A.on("yearChanged",function(){var t=E.getYear();e.setState({year:t})})}},{key:"render",value:function(){return c.a.createElement("div",{style:{padding:"0.4em 2em 0"}},c.a.createElement(h.a,{value:this.state.year,min:1995,max:2017,included:!1,marks:T,step:null,onChange:Y,defaultValue:2010,handleStyle:{border:"white",backgroundColor:"silver"}}))}}]),t}(c.a.Component),D=n(36),H=n(49),P=n(51),W=n.n(P),q=function(e){function t(){return Object(d.a)(this,t),Object(m.a)(this,Object(v.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){var e=this.props.events,t=[];return e.forEach(function(e,n){var r=e.year,a=e.name;t.push({value:n,label:"".concat(r," ").concat(a)})}),c.a.createElement(H.a,Object.assign({onChange:function(t,n){for(var r=e[t.value],a=r.name,o=r.year,i=r.countries.split(","),c=0;x[c]<o;)c++;var u=x[c-1]||x[0];console.log("EVENT:",u,a,i),E.setCountries(i),E.setYear(u)},placeholder:"Select an event...",components:W.a,onBlurResetsInput:!1,onSelectResetsInput:!1,onCloseResetsInput:!1,options:t,theme:function(e){return Object(D.a)({},e,{borderRadius:0,colors:Object(D.a)({},e.colors,{neutral0:"#333",neutral5:"orange",neutral10:"#666",neutral20:"#666",primary25:"#666",neutral50:"#eee",neutral80:"white"})})}},this.props))}}]),t}(c.a.PureComponent),V=o.a.get("codeToName");function G(e,t){switch(console.log(e,t),t.action){case"clear":return E.clearCountries();case"select-option":return E.addCountry(t.option.value);case"remove-value":return E.remCountry(t.removedValue.value)}}var J,L,X,z,K,U=function(e){function t(e){var n;return Object(d.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).state={},n}return Object(p.a)(t,e),Object(f.a)(t,[{key:"componentDidMount",value:function(){var e=this;A.on("countriesChanged",function(){var t=E.getCountries().map(function(e){return{value:e,label:V[e]}});e.setState({value:t})})}},{key:"render",value:function(){var e=this.props.data,t=[],n=Object.keys(e).slice(-1);Object.keys(e[n]).forEach(function(e){3===e.length&&t.push({value:e,label:V[e]})});var r=t.sort(function(e,t){return e.label<t.label?-1:1});return c.a.createElement(H.a,Object.assign({isMulti:!0,placeholder:"Select countries...",components:W.a,onBlurResetsInput:!1,onSelectResetsInput:!1,onCloseResetsInput:!1,options:r,value:this.state.value,theme:function(e){return Object(D.a)({},e,{borderRadius:0,colors:Object(D.a)({},e.colors,{neutral0:"#333",neutral5:"orange",neutral10:"#666",neutral20:"#666",primary25:"#666",neutral50:"#eee",neutral80:"white"})})},onChange:G},this.props))}}]),t}(c.a.Component),Q=n(39),Z=n(100),$=n.n(Z),_=function(e){function t(e){var n;return Object(d.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).state={checked:!1},n.handleChange=n.handleChange.bind(Object(Q.a)(Object(Q.a)(n))),n}return Object(p.a)(t,e),Object(f.a)(t,[{key:"componentDidMount",value:function(){var e=this.state.checked;o.a.set("isEmigration",e)}},{key:"handleChange",value:function(e){this.setState({checked:e}),E.setMigration(e)}},{key:"render",value:function(){var e=this.state.checked;return c.a.createElement("div",null,c.a.createElement($.a,{onChange:this.handleChange,checked:e,onColor:"#FFAB91",offColor:"#FFAB91",onHandleColor:"#FF8A65",offHandleColor:"#FF8A65",handleDiameter:24,uncheckedIcon:!1,checkedIcon:!1,boxShadow:"0px 1px 5px rgba(0, 0, 0, 0.6)",activeBoxShadow:"0px 0px 1px 10px rgba(0, 0, 0, 0.2)",height:16,width:64,id:"mySwitcherino"}),c.a.createElement("span",null,e?"Emigration":"Immigration"))}}]),t}(c.a.Component),ee={draw:function(e,t){var n=document.querySelector(e),r=[n.clientWidth,n.clientHeight],a=r[0],o=r[1];J=M(e,{width:a,height:o}),z=.5*Math.min(a,o),K=z-20,X=t,J.attr("viewBox",[-a/2,-o/2,a,o]),J.append("g").attr("class","nodes"),J.append("g").attr("class","arcs"),ne()},update:ne};function te(){L=E.getCountries();var e=E.getMigration(),t=E.getYear(),n=[];return L.forEach(function(r){n.push(L.map(function(n){return function(n,r){var a;try{a=e?X[t][r][n]:X[t][n][r]}catch(o){a=0}return a||0}(r,n)}))}),n}function ne(){console.log("updating chord...");var e=J.select(".nodes"),t=J.select(".arcs");e.selectAll(".node").remove(),t.selectAll(".arc").remove();var n=g.d().padAngle(.02)(te()),a=g.o().radius(K),o=g.q().domain(g.n(S.selection.length)).range(S.selection),i=g.a().innerRadius(K).outerRadius(z);if(0!==n.length){var c=E.getMigration(),u=c?"emigration":"immigration";e.selectAll("g").data(n.groups).enter().append("g").attr("class","node").append("path").attr("fill",function(e,t){return o(t)}).attr("stroke",function(e,t){return o(t)}).attr("d",i).on("mousemove",y.mousemove).on("mouseout",function(e,n){t.selectAll(".arc.show").classed("show",!1),t.selectAll(".arc.fade").classed("fade",!1),y.mouseout()}).on("mouseover",function(e,n){var r=t.selectAll(".arc");r.classed("fade",function(e){return e.source.index!==n&&e.target.index!==n}),r.classed("show",function(e){return e.source.index===n}),y.mouseover("<strong>".concat(N(L[e.index]),"</strong> (").concat(E.getYear(),")<br/>\n      <big>").concat(g.g("~s")(e.value),"</big> ").concat(u.slice(0,-4),"nts<br/>"))}),t.selectAll("path").data(n).enter().append("path").attr("class","arc").attr("fill",function(e){return o(e.target.index)}).attr("d",a).on("mouseover",function(e){return y.mouseover(function(e){var t=c?[e.source,e.target]:[e.target,e.source],n=[e.source,e.target],a=t.map(function(e){return N(L[e.index])}),o=Object(r.a)(a,2),i=o[0],u=o[1],s=n.map(function(e){return g.g("~s")(e.value)}),l=Object(r.a)(s,2),d=l[0],f=l[1];return"".concat(i," \u27f6 ").concat(u,": ").concat(d,"<br/>").concat(u," \u27f6 ").concat(i,": ").concat(f)}(e))}).on("mouseout",y.mouseout).on("mousemove",y.mousemove)}}A.on("yearChanged",function(){return ne()}),A.on("countriesChanged",function(){return ne()}),A.on("migrationChanged",function(){return ne()});var re,ae,oe,ie,ce,ue={draw:function(e,t,n){var r=document.querySelector(e);ae={width:r.clientWidth,height:r.clientHeight},re=M(e,ae,se),ce=t,ie=n,fe()},update:fe},se={top:10,right:20,bottom:20,left:40},le=["GDP per capita","Social support","Healthy life expectancy","Freedom to make life choices","Perceptions of corruption"];function de(){var e={};return ie.forEach(function(t){void 0===e[t.country]&&(e[t.country]=[]),e[t.country].push(function(e){var t={};for(var n in e){var r=Number(e[n]);t[n]=r||e[n]}return t}(t))}),e}function fe(){console.log("updating graph...");var e=ae.width-se.left-se.right,t=ae.height-se.top-se.bottom;oe=o.a.get("selectedCountries");var n=function(){var e={};if(!oe||0===oe.length)return[];var t=!0,n=!1,r=void 0;try{for(var a,o=oe[Symbol.iterator]();!(t=(a=o.next()).done);t=!0){var i=a.value,c=[];for(var u in ce){var s=ce[u];if(void 0!==s[i]){var l=Number(R(s,i));c.push({year:Number(u),value:Number(l)})}}e[i]=c}}catch(d){n=!0,r=d}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}return e}(),r=de(),a=Object.values(n).reduce(function(e,t){return e.concat(t)},[]),i=function(e,t){return[g.m(e,t),g.l(e,t)]},c=g.p().domain(i(a,function(e){return e.year})).nice().range([0,e]),u=g.p().domain(i(a,function(e){return e.value})).nice().range([t,0]),s=le.map(function(e){return g.p().domain(i(ie,function(t){return+t[e]})).nice().range([t,0])}),l=g.b(c).tickFormat(g.g("d")),d=g.c(u).tickFormat(g.g("~s")),f=g.k().x(function(e){return c(e.year)}).y(function(e){return u(e.value)}).curve(g.e);re.selectAll(".country").remove(),re.selectAll(".xAxis").remove(),re.selectAll(".yAxis").remove(),re.append("g").attr("class","xAxis").attr("transform","translate(0,".concat(t,")")).call(l),re.append("g").attr("class","yAxis").call(d);var m=o.a.get("isEmigration")?"emigration":"immigration",v=re.append("g").attr("class","countries");var p=0,h=function(e){var t=n[e],a=S.selection[p++%S.selection.length],o=N(e);if(!t)return"break";var i=v.append("g").attr("id",e).attr("class","country").attr("name",o);if(i.append("path").datum(t).attr("class","line").attr("stroke",a).attr("d",f).on("click",function(){return e=i,v.attr("visibility","hidden"),e.attr("visibility","visible"),e.selectAll(".selected").classed("selected",!1),void e.selectAll(".metrics").classed("selected",!0);var e}).on("contextmenu",function(){return e=i,g.f.preventDefault(),v.attr("visibility","visible"),e.attr("visibility",null),e.selectAll(".selected").classed("selected",!1),void e.selectAll(".metrics").attr("visibility","hidden");var e}).on("mousemove",y.mousemove).on("mouseover",function(e){i.selectAll(".metrics").attr("visibility","visible"),y.mouseover("".concat(o," ").concat(m))}).on("mouseout",function(e){i.selectAll(".metrics").attr("visibility","hidden")}),i.append("g").attr("class","dots").attr("fill",a).attr("stroke",a).selectAll().data(t).enter().append("circle").attr("cx",function(e){return c(e.year)}).attr("cy",function(e){return u(e.value)}).attr("r",3).on("mouseout",y.mouseout).on("mousemove",y.mousemove).on("mouseover",function(e){return y.mouseover("<strong>".concat(o,"</strong> (").concat(e.year,")<br/>\n        ").concat(g.g("~s")(e.value)," ").concat(m.slice(0,-4),"nts"))}),!r[e])return"break";var l=i.append("g").attr("class","metrics").attr("visibility","hidden");le.forEach(function(t,n){var a=g.j(n/le.length),i=g.k().x(function(e){return c(e.year)}).y(function(e){return s[n](e[t])}).defined(function(e){return e[t]}).curve(g.e),u=l.append("g").attr("class","metric");u.append("path").datum(r[e]).attr("stroke",a).attr("fill","none").attr("opacity",.8).attr("d",i).on("mouseout",y.mouseout).on("mousemove",y.mousemove).on("mouseover",function(e){return y.mouseover("<strong>".concat(o,":</strong> ").concat(t))}),u.append("g").attr("fill",a).attr("stroke",a).selectAll("circle").data(r[e]).enter().append("circle").attr("class","circle").attr("cx",function(e){return c(e.year)}).attr("cy",function(e){return s[n](e[t])}).attr("r",function(e){return""===e[t]?0:3}).on("mouseout",y.mouseout).on("mousemove",y.mousemove).on("mouseover",function(e){return y.mouseover("<strong>".concat(o,"</strong> (").concat(e.year,")<br/>\n          <small>").concat(t,"</small><br/>\n          ").concat(e[t]))})})};for(var b in n){if("break"===h(b))break}}A.on("countriesChanged",function(){return fe()}),A.on("migrationChanged",function(){return fe()});var me,ve,pe,he={draw:function(e,t,n,r){var a=document.querySelector(e),o=[a.clientWidth,a.clientHeight],i=o[0],c=o[1];me=M(e,{width:i,height:c}),ve=n,pe=r;var u=g.h().scale(i/5).translate([i/2,c/.8]),s=g.i().projection(u),l=g.w().scaleExtent([.6,7]).on("zoom",function(){d.selectAll("path").attr("transform",g.f.transform)});me.call(l);var d=me.append("g").attr("class","countries");d.selectAll("path").data(t.features).enter().append("path").attr("id",function(e){return e.id}).attr("name",function(e){return e.properties.name}).attr("d",s).on("click",be).on("contextmenu",ge).on("mouseover",y.mouseover).on("mouseout",y.mouseout).on("mousemove",y.mousemove),ye()},update:ye};function ge(e){g.f.preventDefault(),E.remCountry(e.id)}function be(e){["UNK","TWN","ATA"].includes(e.id)||E.addCountry(e.id)}function ye(){console.log("updating map...");var e=o.a.get("selectedCountries")||[],t=o.a.get("year")||2010,n=ve[t];function r(e){return void 0===n[e.id]?0:R(n,e.id)/pe[e.id][t]||0}var a=g.r().domain([-20,-10,-5,-2.5,0,2.5,5,10,20]).range(S.map);me.selectAll("path").style("fill",function(e){return a(r(e))}).on("mouseover",function(e){return y.mouseover("<strong>".concat(N(e.id),"</strong> (").concat(t,")<br/>\n      <big>").concat(g.g(".1f")(r(e)),"</big> migrants<br/>\n      <small>/1000 population</small>"))}),g.v(".selected").classed("selected",!1),e.forEach(function(e,t){g.u("path#"+e).style("fill",S.selection[t%S.selection.length]).classed("selected",!0)})}A.on("yearChanged",function(){return ye()}),A.on("countriesChanged",function(){return ye()}),A.on("migrationChanged",function(){return ye()});n(198),n(199);o.a.remove("selectedCountries"),o.a.remove("isEmigration"),o.a.set("year",2010),o.a.set("selectedCountries",["PRT"]);var Ce=[Object(l.a)("./data/topology.json"),Object(l.a)("./data/migrations.json"),Object(l.b)("./data/conversion.tsv"),Object(l.b)("./data/population.tsv"),Object(l.b)("./data/events.tsv"),Object(l.b)("./data/whr2018.tsv")];Promise.all(Ce).then(function(e){return function(e){var t=Object(r.a)(e,6),n=t[0],a=t[1],i=t[2],u=t[3],l=t[4],d=t[5],f=function(e){function t(e,t){var n=e.indexOf(t);return n>0?e[n-1]:e[0]}var n={},r=Object.keys(e);for(var a in e)if(a!==r[0])for(var o in n[a]={},e[a])for(var i in n[a][o]={},e[a][o]){var c=e[a][o],u=e[t(r,a)][o]||{};n[a][o][i]=c[i]-(u[i]||0)}return n}(a),m={},v={},p={};u.forEach(function(e){return v[e.Country]=F(e)}),d.forEach(function(e){return p[e.country]=F(e)}),i.forEach(function(e){return m[e.code3]=e.name}),o.a.set("codeToName",m),he.draw("#map",n,f,v),ue.draw("#graph",f,d,v),ee.draw("#chord",a),s.a.render(c.a.createElement(U,{data:a}),I("countrySelect")),s.a.render(c.a.createElement(q,{events:l}),I("eventList")),s.a.render(c.a.createElement(_,null),I("migrationSwitch")),s.a.render(c.a.createElement(B,null),I("yearSlider")),E.setCountries(["PRT","FRA","GBR"])}(e)})}},[[103,1,2]]]);
//# sourceMappingURL=main.f6af4983.chunk.js.map