(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{102:function(t,e,n){t.exports=n(202)},174:function(t,e,n){},198:function(t,e,n){},200:function(t,e,n){},202:function(t,e,n){"use strict";n.r(e);var a=n(39),r=n(9),c=n.n(r),o=n(1),i=n.n(o),l=n(8),u=n.n(l),s=n(19),d=n(28),f=n(29),p=n(33),h=n(30),g=n(34),v=n(100),m=n(2);var b=9,y={map:m.r[b],selection:m.s[b]};function x(t){return c.a.get("codeToName")[t]}function w(t){var e={};for(var n in t){var a=Number(t[n]);isNaN(a)||0===a||(e[n]=a)}return e}function j(t){return document.getElementById(t)}function O(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{width:400,height:400},n=arguments.length>2?arguments[2]:void 0,a=m.t(t).append("svg").attr("width",e.width).attr("height",e.height);return void 0!==n?a.append("g").attr("class","main").attr("transform","translate(".concat(n.left||0,",").concat(n.top||0,")")):a}var A,k,C,E,S,F={draw:function(t,e){var n=document.querySelector(t),a=[n.clientWidth,n.clientHeight],r=a[0],c=a[1];A=O(t,{width:r,height:c}),E=.5*Math.min(r,c),S=E-20,C=e,A.attr("viewBox",[-r/2,-c/2,r,c]),A.append("g").attr("class","nodes"),A.append("g").attr("class","arcs"),D()},update:D};function R(){k=Object.keys(C[2010].WORLD).slice(1,40);var t=c.a.get("isEmigration"),e=c.a.get("year")||2010,n=[];return k.forEach(function(a){n.push(k.map(function(n){return function(n,a){var r;try{r=t?C[e][a][n]:C[e][n][a]}catch(c){r=0}return r||0}(a,n)}))}),n}function D(){console.log("updating chord...");var t=A.select(".nodes"),e=A.select(".arcs");t.selectAll(".node").remove(),e.selectAll(".arc").remove();var n=m.d().padAngle(.02)(R()),r=m.n().radius(S),o=m.p().domain(m.m(9)).range(y.selection),i=m.a().innerRadius(S).outerRadius(E);t.selectAll("g").data(n.groups).enter().append("g").attr("class","node").append("path").attr("fill",function(t,e){return o(e)}).attr("stroke",function(t,e){return o(e)}).attr("d",i).on("mouseover",function(t,n){var a=e.selectAll(".arc");a.classed("fade",function(t){return t.source.index!==n&&t.target.index!==n}),a.classed("show",function(t){return t.source.index===n})}).on("mouseout",function(t,n){e.selectAll(".arc.show").classed("show",!1),e.selectAll(".arc.fade").classed("fade",!1)}).append("title").text(function(t){return"".concat(x(k[t.index]),": ").concat(m.g("~s")(t.value))}),e.selectAll("path").data(n).enter().append("path").attr("class","arc").attr("d",r).attr("fill",function(t){return o(t.target.index)}).append("title").text(function(t){return function(t){var e=c.a.get("isEmigration")?[t.source,t.target]:[t.target,t.source],n=[t.source,t.target],r=e.map(function(t){return x(k[t.index])}),o=Object(a.a)(r,2),i=o[0],l=o[1],u=n.map(function(t){return m.g("~s")(t.value)}),s=Object(a.a)(u,2),d=s[0],f=s[1];return"".concat(i," > ").concat(l,": ").concat(d,"\n").concat(l," > ").concat(i,": ").concat(f)}(t)})}var N,T,W,I={draw:function(t,e){var n=document.querySelector(t);T={width:n.clientWidth,height:n.clientHeight},N=O(t,T,P),W=e,B()},update:B},P={top:10,right:20,bottom:20,left:40};function B(){console.log("updating plot...");var t=c.a.get("selectedCountries")[0],e=Object.values(W[t]||[]);console.log(e);var n=T.width-P.left-P.right,a=T.height-P.top-P.bottom,r=e.reduce(function(t,e){return t.concat(e)},[]),o=function(t,e){return[m.l(t,e),m.k(t,e)]},i=m.o().domain(o(r,function(t){return t.year})).nice().range([0,n]),l=m.o().domain(o(r,function(t){return t["GDP per capita"]})).nice().range([a,0]),u=m.b(i).tickFormat(m.g("d")),s=m.c(l).tickFormat(m.g("~s"));N.selectAll(".circle").remove(),N.selectAll(".xAxis").remove(),N.selectAll(".yAxis").remove(),N.append("g").attr("class","xAxis").attr("transform","translate(0,".concat(a,")")).call(u),N.append("g").attr("class","yAxis").call(s),N.append("g").attr("class","circles").selectAll("circle").data(e).enter().append("circle").attr("class","circle").attr("cx",function(t){return i(t.year)}).attr("cy",function(t){return l(t["GDP per capita"])}).attr("r",4)}var H,q,M,L,G,J={draw:function(t,e,n){var a=document.querySelector(t);q={width:a.clientWidth,height:a.clientHeight},H=O(t,q,U),M=e,L=n,z()},update:z},U={top:10,right:20,bottom:20,left:40};function z(){console.log("updating lines...");var t,e,n=q.width-U.left-U.right,a=q.height-U.top-U.bottom,r=function(){var t=[];if(!(G=c.a.get("selectedCountries"))||0===G.length)return[];var e=c.a.get("isEmigration"),n=!0,a=!1,r=void 0;try{for(var o,i=G[Symbol.iterator]();!(n=(o=i.next()).done);n=!0){var l=o.value,u=[];for(var s in M){var d=M[s];if(void 0!==d[l]){var f=Number(e?d.WORLD[l]:d[l].Total),p=(L[l][s],f);u.push({year:Number(s),value:Number(p)})}}t.push(u)}}catch(h){a=!0,r=h}finally{try{n||null==i.return||i.return()}finally{if(a)throw r}}return t}(),o=r.reduce(function(t,e){return t.concat(e)},[]),i=m.o().domain((t=o,e=function(t){return t.year},[m.l(t,e),m.k(t,e)])).nice().range([0,n]),l=m.o().domain(function(t,e){return[Math.min(0,m.l(t,e)),m.k(t,e)]}(o,function(t){return t.value})).nice().range([a,0]),u=m.b(i).tickFormat(m.g("d")),s=m.c(l).tickFormat(m.g("~s")),d=m.j().x(function(t){return i(t.year)}).y(function(t){return l(t.value)}).curve(m.e);H.selectAll(".dots").remove(),H.selectAll(".line").remove(),H.select(".xAxis").remove(),H.select(".yAxis").remove(),H.append("g").attr("class","xAxis").attr("transform","translate(0,".concat(a,")")).call(u),H.append("g").attr("class","yAxis").call(s);for(var f=function(t){var e=y.selection[t%b],n=x(G[t]);H.append("path").datum(r[t]).attr("stroke",e).attr("class","line").attr("d",d),H.append("g").attr("class","dots").attr("fill",e).attr("stroke",e).selectAll().data(r[t]).enter().append("circle").attr("cx",function(t){return i(t.year)}).attr("cy",function(t){return l(t.value)}).attr("r",5).append("title").text(function(t){return"".concat(n," (").concat(t.year,"): ").concat(m.g("~s")(t.value))})},p=0;p<r.length;p++)f(p)}var K,V,Q,X={draw:function(t,e,n,a){var r=document.querySelector(t),c=[r.clientWidth,r.clientHeight],o=c[0],i=c[1];K=O(t,{width:o,height:i}),V=n,Q=a;var l=m.h().scale(o/5).translate([o/2,i/.8]),u=m.i().projection(l),s=m.v().scaleExtent([.6,7]).on("zoom",function(){d.selectAll("path").attr("transform",m.f.transform)});K.call(s);var d=K.append("g").attr("class","countries");d.selectAll("path").data(e.features).enter().append("path").attr("id",function(t){return t.id}).attr("name",function(t){return t.properties.name}).attr("d",u).on("click",_).on("mouseover",Y).on("mouseout",Z).on("contextmenu",$).append("title").text(function(t){return"".concat(t.id,": ").concat(t.properties.name)}),tt()},update:tt};function Y(){}function Z(){}function $(t){m.f.preventDefault();var e=new Set(c.a.get("selectedCountries"));e.delete(t.id),c.a.set("selectedCountries",Array.from(e)),tt()}function _(t){if(!["UNK","TWN","ATA"].includes(t.id)){var e=new Set(c.a.get("selectedCountries"));e.add(t.id),c.a.set("selectedCountries",Array.from(e)),tt()}}function tt(){console.log("updating map...");var t=c.a.get("selectedCountries")||[],e=c.a.get("isEmigration"),n=c.a.get("year")||2010,a=V[n];function r(t){if(void 0===a[t.id])return 0;var r=e?a.WORLD[t.id]:a[t.id].Total;Q[t.id][n];return r||0}var o=m.q().domain([-10,-5,-2,-1,0,1,2,5,10].map(function(t){return 100*t*1e3})).range(y.map);K.selectAll("path").style("fill",function(t){return o(r(t))}).select("title").text(function(t){return"".concat(x(t.id),": ").concat(m.g("~s")(r(t)))}),m.u(".selected").classed("selected",!1),t.forEach(function(t,e){m.t("path#"+t).style("fill",y.selection[e%b]).classed("selected",!0)}),J.update(),F.update(),I.update()}n(172),n(174);var et={1995:"1995",2000:"2000",2005:"2005",2010:"2010",2015:"2015",2017:"2017"};function nt(t){c.a.set("year",t),X.update()}var at=function(t){function e(){return Object(d.a)(this,e),Object(p.a)(this,Object(h.a)(e).apply(this,arguments))}return Object(g.a)(e,t),Object(f.a)(e,[{key:"render",value:function(){return i.a.createElement("div",{style:{padding:"0.4em 2em 0"}},i.a.createElement(v.a,{min:1995,max:2017,included:!1,marks:et,step:null,onChange:nt,defaultValue:2010,handleStyle:{border:"white",backgroundColor:"silver"}}))}}]),e}(i.a.PureComponent),rt=n(68),ct=n(96),ot=n(98),it=n.n(ot),lt=function(t){function e(){return Object(d.a)(this,e),Object(p.a)(this,Object(h.a)(e).apply(this,arguments))}return Object(g.a)(e,t),Object(f.a)(e,[{key:"render",value:function(){var t=this.props.countries.sort(function(t,e){return t.label<e.label?-1:1});return i.a.createElement(ct.a,Object.assign({isMulti:!0,placeholder:"Select countries...",components:it.a,onBlurResetsInput:!1,onSelectResetsInput:!1,onCloseResetsInput:!1,options:t,theme:function(t){return Object(rt.a)({},t,{borderRadius:0,colors:Object(rt.a)({},t.colors,{neutral0:"#333",neutral5:"orange",neutral10:"#666",neutral20:"#666",primary25:"#666",neutral50:"#eee",neutral80:"white"})})}},this.props))}}]),e}(i.a.PureComponent),ut=n(38),st=n(99),dt=n.n(st),ft=function(t){function e(t){var n;return Object(d.a)(this,e),(n=Object(p.a)(this,Object(h.a)(e).call(this,t))).state={checked:!1},n.handleChange=n.handleChange.bind(Object(ut.a)(Object(ut.a)(n))),n}return Object(g.a)(e,t),Object(f.a)(e,[{key:"componentDidMount",value:function(){var t=this.state.checked;c.a.set("isEmigration",t)}},{key:"handleChange",value:function(t){c.a.set("isEmigration",t),this.setState({checked:t}),X.update()}},{key:"render",value:function(){var t=this.state.checked;return i.a.createElement("div",null,i.a.createElement(dt.a,{onChange:this.handleChange,checked:t,onColor:"#FFCC80",offColor:"#FFAB91",onHandleColor:"#FFB74D",offHandleColor:"#FF8A65",handleDiameter:24,uncheckedIcon:!1,checkedIcon:!1,boxShadow:"0px 1px 5px rgba(0, 0, 0, 0.6)",activeBoxShadow:"0px 0px 1px 10px rgba(0, 0, 0, 0.2)",height:16,width:64,id:"mySwitcherino"}),i.a.createElement("span",null,t?"Emigration":"Immigration"))}}]),e}(i.a.Component);n(198),n(200);c.a.remove("selectedCountries"),c.a.remove("isEmigration"),c.a.set("selectedCountries",["PRT","ESP","FRA","DEU"]);var pt=j("graphToggle"),ht=j("lines"),gt=j("plot");pt.onclick=function(t){ht.hidden?(ht.hidden=!1,gt.hidden=!0):(ht.hidden=!0,gt.hidden=!1)};var vt=[Object(s.a)("./data/topology.json"),Object(s.a)("./data/migrations.json"),Object(s.b)("./data/conversion.tsv"),Object(s.b)("./data/population.tsv"),Object(s.b)("./data/whr2018.tsv")];Promise.all(vt).then(function(t){return function(t){var e=Object(a.a)(t,5),n=e[0],r=e[1],o=e[2],l=e[3],s=e[4],d=function(t){function e(t,e){var n=t.indexOf(e);return n>0?t[n-1]:t[0]}var n={},a=Object.keys(t);for(var r in t)if(r!==a[0])for(var c in n[r]={},t[r])for(var o in n[r][c]={},t[r][c]){var i=t[r][c],l=t[e(a,r)][c]||{};n[r][c][o]=i[o]-(l[o]||0)}return n}(r),f={};s.forEach(function(t){void 0===f[t.country]&&(f[t.country]={}),f[t.country][t.year]=w(t)}),console.log(f);var p={},h={},g={};l.forEach(function(t){return h[t.Country]=w(t)}),s.forEach(function(t){return g[t.country]=w(t)}),o.forEach(function(t){return p[t.code3]=t.name}),c.a.set("codeToName",p),F.draw("#chord",r),I.draw("#plot",f),J.draw("#lines",d,h),X.draw("#map",n,d,h),gt.hidden=!0,u.a.render(function(t,e){var n=[];return Object.keys(t[2e3]).forEach(function(t){3===t.length&&n.push({value:t,label:e[t]})}),i.a.createElement(lt,{countries:n,onChange:function(t){var e=new Set(c.a.get("selectedCountries"));t.forEach(function(t){return e.add(t.value)}),c.a.set("selectedCountries",Array.from(e)),X.update()}})}(d,p),j("countrySelect")),u.a.render(i.a.createElement(ft,null),j("migrationSwitch")),u.a.render(i.a.createElement(at,null),j("yearSlider"))}(t)})}},[[102,2,1]]]);
//# sourceMappingURL=main.25f0b5e7.chunk.js.map