(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{102:function(t,e,n){t.exports=n(202)},174:function(t,e,n){},198:function(t,e,n){},200:function(t,e,n){},202:function(t,e,n){"use strict";n.r(e);var r=n(39),a=n(9),c=n.n(a),o=n(1),i=n.n(o),u=n(8),l=n.n(u),s=n(19),d=n(28),f=n(29),p=n(33),h=n(30),v=n(34),m=n(100),g=n(2);var b=9,y={map:g.s[b],selection:g.t[b]};function j(t){return c.a.get("codeToName")[t]}function O(t){var e={};for(var n in t){var r=Number(t[n]);isNaN(r)||0===r||(e[n]=r)}return e}function w(t){return document.getElementById(t)}function x(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{width:400,height:400},n=arguments.length>2?arguments[2]:void 0,r=g.u(t).append("svg").attr("width",e.width).attr("height",e.height);return void 0!==n?r.append("g").attr("class","main").attr("transform","translate(".concat(n.left||0,",").concat(n.top||0,")")):r}var C,E,k,A,S,F={draw:function(t,e){var n=document.querySelector(t),r=[n.clientWidth,n.clientHeight],a=r[0],c=r[1];C=x(t,{width:a,height:c}),A=.5*Math.min(a,c),S=A-20,k=e,C.attr("viewBox",[-a/2,-c/2,a,c]),C.append("g").attr("class","nodes"),C.append("g").attr("class","arcs"),R()},update:R};function N(){E=Object.keys(k[2010].WORLD).slice(1,40);var t=c.a.get("isEmigration"),e=c.a.get("year")||2010,n=[];return E.forEach(function(r){n.push(E.map(function(n){return function(n,r){var a;try{a=t?k[e][r][n]:k[e][n][r]}catch(c){a=0}return a||0}(r,n)}))}),n}function R(){console.log("updating chord...");var t=C.select(".nodes"),e=C.select(".arcs");t.selectAll(".node").remove(),e.selectAll(".arc").remove();var n=g.e().padAngle(.02)(N()),a=g.o().radius(S),o=g.q().domain(g.n(9)).range(y.selection),i=g.a().innerRadius(S).outerRadius(A);t.selectAll("g").data(n.groups).enter().append("g").attr("class","node").append("path").attr("fill",function(t,e){return o(e)}).attr("stroke",function(t,e){return o(e)}).attr("d",i).on("mouseover",function(t,n){var r=e.selectAll(".arc");r.classed("fade",function(t){return t.source.index!==n&&t.target.index!==n}),r.classed("show",function(t){return t.source.index===n})}).on("mouseout",function(t,n){e.selectAll(".arc.show").classed("show",!1),e.selectAll(".arc.fade").classed("fade",!1)}).append("title").text(function(t){return"".concat(j(E[t.index]),": ").concat(g.h("~s")(t.value))}),e.selectAll("path").data(n).enter().append("path").attr("class","arc").attr("d",a).attr("fill",function(t){return o(t.target.index)}).append("title").text(function(t){return function(t){var e=c.a.get("isEmigration")?[t.source,t.target]:[t.target,t.source],n=[t.source,t.target],a=e.map(function(t){return j(E[t.index])}),o=Object(r.a)(a,2),i=o[0],u=o[1],l=n.map(function(t){return g.h("~s")(t.value)}),s=Object(r.a)(l,2),d=s[0],f=s[1];return"".concat(i," > ").concat(u,": ").concat(d,"\n").concat(u," > ").concat(i,": ").concat(f)}(t)})}var D,I,T,W,B,P,H={draw:function(t,e,n,r){var a=document.querySelector(t);I={width:a.clientWidth,height:a.clientHeight},D=x(t,I,q),W=e,B=r,T=n,J()},update:J},q={top:10,right:20,bottom:20,left:40},M="GDP per capita";function L(){var t={};return T.forEach(function(e){void 0===t[e.country]&&(t[e.country]={}),t[e.country][e.year]=function(t){var e={};for(var n in t){var r=Number(t[n]);e[n]=r||t[n]}return e}(e)}),t}function J(){console.log("updating lines...");var t=I.width-q.left-q.right,e=I.height-q.top-q.bottom,n=function(){var t={};if(!(P=c.a.get("selectedCountries"))||0===P.length)return[];var e=c.a.get("isEmigration"),n=!0,r=!1,a=void 0;try{for(var o,i=P[Symbol.iterator]();!(n=(o=i.next()).done);n=!0){var u=o.value,l=[];for(var s in W){var d=W[s];if(void 0!==d[u]){var f=Number(e?d.WORLD[u]:d[u].Total),p=(B[u][s],f);l.push({year:Number(s),value:Number(p)})}}t[u]=l}}catch(h){r=!0,a=h}finally{try{n||null==i.return||i.return()}finally{if(r)throw a}}return t}(),r=Object.values(n),a=L(),o=r.reduce(function(t,e){return t.concat(e)},[]),i=T.filter(function(t){return P.includes(t.country)}),u=g.p().domain(function(t,e){return[g.m(t,e),g.l(t,e)]}(o,function(t){return t.year})).nice().range([0,t]),l=g.p().domain(function(t,e){return[Math.min(0,g.m(t,e)),g.l(t,e)]}(o,function(t){return t.value})).nice().range([e,0]),s=g.p().domain(function(t,e){return[g.m(t,e),g.l(t,e)]}(i,function(t){return+t[M]})).nice().range([e,0]),d=g.b(u).tickFormat(g.h("d")),f=g.c(l).tickFormat(g.h("~s")),p=(g.d(s).tickFormat(g.h("~s")),g.k().x(function(t){return u(t.year)}).y(function(t){return l(t.value)}).curve(g.f));D.selectAll(".country").remove(),D.selectAll(".xAxis").remove(),D.selectAll(".yAxis").remove(),D.append("g").attr("class","xAxis").attr("transform","translate(0,".concat(e,")")).call(d),D.append("g").attr("class","yAxis").call(f);for(var h=function(t){var e=y.selection[t%b],n=j(P[t]),c=D.append("g").attr("class","country").attr("name",n);c.append("path").datum(r[t]).attr("stroke",e).attr("class","line").attr("d",p),c.append("g").attr("class","dots").attr("fill",e).attr("stroke",e).selectAll().data(r[t]).enter().append("circle").attr("cx",function(t){return u(t.year)}).attr("cy",function(t){return l(t.value)}).attr("r",3).append("title").text(function(t){return"".concat(n," (").concat(t.year,"): ").concat(g.h("~s")(t.value))}),c.append("g").attr("class","circles").selectAll("circle").data(Object.values(a[P[t]])).enter().append("circle").attr("class","circle").attr("fill",e).attr("stroke",e).attr("cx",function(t){return u(t.year)}).attr("cy",function(t){return s(t[M])}).attr("r",5)},v=0;v<r.length;v++)h(v)}var U,z,G,K={draw:function(t,e,n,r){var a=document.querySelector(t),c=[a.clientWidth,a.clientHeight],o=c[0],i=c[1];U=x(t,{width:o,height:i}),z=n,G=r;var u=g.i().scale(o/5).translate([o/2,i/.8]),l=g.j().projection(u),s=g.w().scaleExtent([.6,7]).on("zoom",function(){d.selectAll("path").attr("transform",g.g.transform)});U.call(s);var d=U.append("g").attr("class","countries");d.selectAll("path").data(e.features).enter().append("path").attr("id",function(t){return t.id}).attr("name",function(t){return t.properties.name}).attr("d",l).on("click",Y).on("mouseover",V).on("mouseout",Q).on("contextmenu",X).append("title").text(function(t){return"".concat(t.id,": ").concat(t.properties.name)}),Z()},update:Z};function V(){}function Q(){}function X(t){g.g.preventDefault();var e=new Set(c.a.get("selectedCountries"));e.delete(t.id),c.a.set("selectedCountries",Array.from(e)),Z()}function Y(t){if(!["UNK","TWN","ATA"].includes(t.id)){var e=new Set(c.a.get("selectedCountries"));e.add(t.id),c.a.set("selectedCountries",Array.from(e)),Z()}}function Z(){console.log("updating map...");var t=c.a.get("selectedCountries")||[],e=c.a.get("isEmigration"),n=c.a.get("year")||2010,r=z[n];function a(t){if(void 0===r[t.id])return 0;var a=e?r.WORLD[t.id]:r[t.id].Total;G[t.id][n];return a||0}var o=g.r().domain([-10,-5,-2,-1,0,1,2,5,10].map(function(t){return 100*t*1e3})).range(y.map);U.selectAll("path").style("fill",function(t){return o(a(t))}).select("title").text(function(t){return"".concat(j(t.id),": ").concat(g.h("~s")(a(t)))}),g.v(".selected").classed("selected",!1),t.forEach(function(t,e){g.u("path#"+t).style("fill",y.selection[e%b]).classed("selected",!0)}),H.update(),F.update()}n(172),n(174);var $={1995:"1995",2000:"2000",2005:"2005",2010:"2010",2015:"2015",2017:"2017"};function _(t){c.a.set("year",t),K.update()}var tt=function(t){function e(){return Object(d.a)(this,e),Object(p.a)(this,Object(h.a)(e).apply(this,arguments))}return Object(v.a)(e,t),Object(f.a)(e,[{key:"render",value:function(){return i.a.createElement("div",{style:{padding:"0.4em 2em 0"}},i.a.createElement(m.a,{min:1995,max:2017,included:!1,marks:$,step:null,onChange:_,defaultValue:2010,handleStyle:{border:"white",backgroundColor:"silver"}}))}}]),e}(i.a.PureComponent),et=n(68),nt=n(96),rt=n(98),at=n.n(rt),ct=function(t){function e(){return Object(d.a)(this,e),Object(p.a)(this,Object(h.a)(e).apply(this,arguments))}return Object(v.a)(e,t),Object(f.a)(e,[{key:"render",value:function(){var t=this.props.countries.sort(function(t,e){return t.label<e.label?-1:1});return i.a.createElement(nt.a,Object.assign({isMulti:!0,placeholder:"Select countries...",components:at.a,onBlurResetsInput:!1,onSelectResetsInput:!1,onCloseResetsInput:!1,options:t,theme:function(t){return Object(et.a)({},t,{borderRadius:0,colors:Object(et.a)({},t.colors,{neutral0:"#333",neutral5:"orange",neutral10:"#666",neutral20:"#666",primary25:"#666",neutral50:"#eee",neutral80:"white"})})}},this.props))}}]),e}(i.a.PureComponent),ot=n(38),it=n(99),ut=n.n(it),lt=function(t){function e(t){var n;return Object(d.a)(this,e),(n=Object(p.a)(this,Object(h.a)(e).call(this,t))).state={checked:!1},n.handleChange=n.handleChange.bind(Object(ot.a)(Object(ot.a)(n))),n}return Object(v.a)(e,t),Object(f.a)(e,[{key:"componentDidMount",value:function(){var t=this.state.checked;c.a.set("isEmigration",t)}},{key:"handleChange",value:function(t){c.a.set("isEmigration",t),this.setState({checked:t}),K.update()}},{key:"render",value:function(){var t=this.state.checked;return i.a.createElement("div",null,i.a.createElement(ut.a,{onChange:this.handleChange,checked:t,onColor:"#FFCC80",offColor:"#FFAB91",onHandleColor:"#FFB74D",offHandleColor:"#FF8A65",handleDiameter:24,uncheckedIcon:!1,checkedIcon:!1,boxShadow:"0px 1px 5px rgba(0, 0, 0, 0.6)",activeBoxShadow:"0px 0px 1px 10px rgba(0, 0, 0, 0.2)",height:16,width:64,id:"mySwitcherino"}),i.a.createElement("span",null,t?"Emigration":"Immigration"))}}]),e}(i.a.Component);n(198),n(200);c.a.remove("selectedCountries"),c.a.remove("isEmigration"),c.a.set("selectedCountries",["PRT","ESP","FRA","DEU"]);var st=[Object(s.a)("./data/topology.json"),Object(s.a)("./data/migrations.json"),Object(s.b)("./data/conversion.tsv"),Object(s.b)("./data/population.tsv"),Object(s.b)("./data/whr2018.tsv")];Promise.all(st).then(function(t){return function(t){var e=Object(r.a)(t,5),n=e[0],a=e[1],o=e[2],u=e[3],s=e[4],d=function(t){function e(t,e){var n=t.indexOf(e);return n>0?t[n-1]:t[0]}var n={},r=Object.keys(t);for(var a in t)if(a!==r[0])for(var c in n[a]={},t[a])for(var o in n[a][c]={},t[a][c]){var i=t[a][c],u=t[e(r,a)][c]||{};n[a][c][o]=i[o]-(u[o]||0)}return n}(a),f={},p={},h={};u.forEach(function(t){return p[t.Country]=O(t)}),s.forEach(function(t){return h[t.country]=O(t)}),o.forEach(function(t){return f[t.code3]=t.name}),c.a.set("codeToName",f),F.draw("#chord",a),H.draw("#lines",d,s,p),K.draw("#map",n,d,p),l.a.render(function(t,e){var n=[];return Object.keys(t[2e3]).forEach(function(t){3===t.length&&n.push({value:t,label:e[t]})}),i.a.createElement(ct,{countries:n,onChange:function(t){var e=new Set(c.a.get("selectedCountries"));t.forEach(function(t){return e.add(t.value)}),c.a.set("selectedCountries",Array.from(e)),K.update()}})}(d,f),w("countrySelect")),l.a.render(i.a.createElement(lt,null),w("migrationSwitch")),l.a.render(i.a.createElement(tt,null),w("yearSlider"))}(t)})}},[[102,2,1]]]);
//# sourceMappingURL=main.b6eaf74d.chunk.js.map