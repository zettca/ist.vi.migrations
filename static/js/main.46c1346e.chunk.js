(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{102:function(t,e,n){t.exports=n(202)},172:function(t,e,n){},176:function(t,e,n){},200:function(t,e,n){},202:function(t,e,n){"use strict";n.r(e);var r=n(39),a=n(9),c=n.n(a),o=n(1),i=n.n(o),u=n(8),l=n.n(u),s=n(19),d=n(28),f=n(29),p=n(33),h=n(30),v=n(34),m=n(100),g=n(3);var y=9,b={map:g.s[y],selection:g.t[y]};function x(t,e){return c.a.get("isEmigration")?t.WORLD[e]:t[e].Total}function w(t){return c.a.get("codeToName")[t]}function j(t){var e={};for(var n in t){var r=Number(t[n]);isNaN(r)||0===r||(e[n]=r)}return e}function A(t){return document.getElementById(t)}function O(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{width:400,height:400},n=arguments.length>2?arguments[2]:void 0,r=g.u(t).append("svg").attr("width",e.width).attr("height",e.height);return void 0!==n?r.append("g").attr("class","main").attr("transform","translate(".concat(n.left||0,",").concat(n.top||0,")")):r}var k,C,E,S,F,N={draw:function(t,e){var n=document.querySelector(t),r=[n.clientWidth,n.clientHeight],a=r[0],c=r[1];k=O(t,{width:a,height:c}),S=.5*Math.min(a,c),F=S-20,E=e,k.attr("viewBox",[-a/2,-c/2,a,c]),k.append("g").attr("class","nodes"),k.append("g").attr("class","arcs"),D()},update:D};function R(){C=c.a.get("selectedCountries");var t=c.a.get("isEmigration"),e=c.a.get("year")||2010,n=[];return C.forEach(function(r){n.push(C.map(function(n){return function(n,r){var a;try{a=t?E[e][r][n]:E[e][n][r]}catch(c){a=0}return a||0}(r,n)}))}),n}function D(){console.log("updating chord...");var t=k.select(".nodes"),e=k.select(".arcs");t.selectAll(".node").remove(),e.selectAll(".arc").remove();var n=g.d().padAngle(.02)(R()),a=g.o().radius(F),o=g.q().domain(g.n(9)).range(b.selection),i=g.a().innerRadius(F).outerRadius(S);t.selectAll("g").data(n.groups).enter().append("g").attr("class","node").append("path").attr("fill",function(t,e){return o(e)}).attr("stroke",function(t,e){return o(e)}).attr("d",i).on("mouseover",function(t,n){var r=e.selectAll(".arc");r.classed("fade",function(t){return t.source.index!==n&&t.target.index!==n}),r.classed("show",function(t){return t.source.index===n})}).on("mouseout",function(t,n){e.selectAll(".arc.show").classed("show",!1),e.selectAll(".arc.fade").classed("fade",!1)}).append("title").text(function(t){return"".concat(w(C[t.index]),": ").concat(g.g("~s")(t.value))}),e.selectAll("path").data(n).enter().append("path").attr("class","arc").attr("d",a).attr("fill",function(t){return o(t.target.index)}).append("title").text(function(t){return function(t){var e=c.a.get("isEmigration")?[t.source,t.target]:[t.target,t.source],n=[t.source,t.target],a=e.map(function(t){return w(C[t.index])}),o=Object(r.a)(a,2),i=o[0],u=o[1],l=n.map(function(t){return g.g("~s")(t.value)}),s=Object(r.a)(l,2),d=s[0],f=s[1];return"".concat(i," > ").concat(u,": ").concat(d,"\n").concat(u," > ").concat(i,": ").concat(f)}(t)})}var I,P,B,H,T,W,q={draw:function(t,e,n,r){var a=document.querySelector(t);P={width:a.clientWidth,height:a.clientHeight},I=O(t,P,M),T=e,W=r,H=n,z()},update:z},M={top:10,right:20,bottom:20,left:40},J=["GDP per capita","Social support","Healthy life expectancy","Freedom to make life choices","Perceptions of corruption"];function U(){var t={};return H.forEach(function(e){void 0===t[e.country]&&(t[e.country]=[]),t[e.country].push(function(t){var e={};for(var n in t){var r=Number(t[n]);e[n]=r||t[n]}return e}(e))}),t}function z(){console.log("updating graph...");var t=P.width-M.left-M.right,e=P.height-M.top-M.bottom;B=c.a.get("selectedCountries");var n=function(){var t={};if(!B||0===B.length)return[];var e=!0,n=!1,r=void 0;try{for(var a,c=B[Symbol.iterator]();!(e=(a=c.next()).done);e=!0){var o=a.value,i=[];for(var u in T){var l=T[u];if(void 0!==l[o]){var s=Number(x(l,o)),d=(W[o][u],s);i.push({year:Number(u),value:Number(d)})}}t[o]=i}}catch(f){n=!0,r=f}finally{try{e||null==c.return||c.return()}finally{if(n)throw r}}return t}(),r=U(),a=Object.values(n).reduce(function(t,e){return t.concat(e)},[]);console.log(H),console.log(r);var o=function(t,e){return[g.m(t,e),g.l(t,e)]},i=g.p().domain(o(a,function(t){return t.year})).nice().range([0,t]),u=g.p().domain(o(a,function(t){return t.value})).nice().range([e,0]),l=J.map(function(t){return g.p().domain(o(H,function(e){return+e[t]})).nice().range([e,0])}),s=(B.reduce(function(t,n){return t[n]=J.map(function(t){return g.p().domain(o(r[n],function(e){return+e[t]})).nice().range([e,0])}),t},{}),g.b(i).tickFormat(g.g("d"))),d=g.c(u).tickFormat(g.g("~s")),f=g.k().x(function(t){return i(t.year)}).y(function(t){return u(t.value)}).curve(g.e);I.selectAll(".country").remove(),I.selectAll(".xAxis").remove(),I.selectAll(".yAxis").remove(),I.append("g").attr("class","xAxis").attr("transform","translate(0,".concat(e,")")).call(s),I.append("g").attr("class","yAxis").call(d);var p=c.a.get("isEmigration")?"emigration":"immigration";var h=I.append("g").attr("class","countries"),v=0,m=function(t){var e=n[t],a=b.selection[v++%y],c=w(t),o=h.append("g").attr("id",t).attr("class","country").attr("name",c);o.append("path").datum(e).attr("class","line").attr("stroke",a).attr("d",f).on("click",function(){return t=o,I.selectAll(".selected").classed("selected",!1),void t.selectAll(".metrics").classed("selected",!0);var t}).on("contextmenu",function(){return t=o,g.f.preventDefault(),t.selectAll(".selected").classed("selected",!1),void t.selectAll(".metrics").attr("visibility","hidden");var t}).on("mouseenter",function(){return o.selectAll(".metrics").attr("visibility","visible")}).on("mouseout",function(){return o.selectAll(".metrics").attr("visibility","hidden")}).append("title").text(function(){return"".concat(c," ").concat(p," line")}),o.append("g").attr("class","dots").attr("fill",a).attr("stroke",a).selectAll().data(e).enter().append("circle").attr("cx",function(t){return i(t.year)}).attr("cy",function(t){return u(t.value)}).attr("r",3).append("title").text(function(t){return"".concat(c," (").concat(t.year,"): ").concat(g.g("~s")(t.value))});var s=o.append("g").attr("class","metrics").attr("visibility","hidden");J.forEach(function(e,n){var a=g.j(n/J.length),o=g.k().x(function(t){return i(t.year)}).y(function(t){return l[n](t[e])}).curve(g.e),u=s.append("g").attr("class","metric");u.append("path").datum(r[t]).attr("stroke",a).attr("fill","none").attr("opacity",.8).attr("d",o).append("title").text(function(){return e}),u.append("g").attr("fill",a).attr("stroke",a).selectAll("circle").data(r[t]).enter().append("circle").attr("class","circle").attr("cx",function(t){return i(t.year)}).attr("cy",function(t){return l[n](t[e])}).attr("r",3).append("title").text(function(t){return"".concat(c," (").concat(t.year,"): ").concat(t[e]," ").concat(e)})})};for(var j in n)m(j)}var G,K,L,V={draw:function(t,e,n,r){var a=document.querySelector(t),c=[a.clientWidth,a.clientHeight],o=c[0],i=c[1];G=O(t,{width:o,height:i}),K=n,L=r;var u=g.h().scale(o/5).translate([o/2,i/.8]),l=g.i().projection(u),s=g.w().scaleExtent([.6,7]).on("zoom",function(){d.selectAll("path").attr("transform",g.f.transform)});G.call(s);var d=G.append("g").attr("class","countries");d.selectAll("path").data(e.features).enter().append("path").attr("id",function(t){return t.id}).attr("name",function(t){return t.properties.name}).attr("d",l).on("click",Z).on("mouseover",Q).on("mouseout",X).on("contextmenu",Y).append("title").text(function(t){return"".concat(t.id,": ").concat(t.properties.name)}),$()},update:$};function Q(){}function X(){}function Y(t){g.f.preventDefault();var e=new Set(c.a.get("selectedCountries"));e.delete(t.id),c.a.set("selectedCountries",Array.from(e)),$()}function Z(t){if(!["UNK","TWN","ATA"].includes(t.id)){var e=new Set(c.a.get("selectedCountries"));e.add(t.id),c.a.set("selectedCountries",Array.from(e)),$()}}function $(){console.log("updating map...");var t=c.a.get("selectedCountries")||[],e=c.a.get("year")||2010,n=K[e];function r(t){return void 0===n[t.id]?0:x(n,t.id)/L[t.id][e]||0}var a=g.r().domain([-20,-10,-5,-2.5,0,2.5,5,10,20]).range(b.map);G.selectAll("path").style("fill",function(t){return a(r(t))}).select("title").text(function(t){return"".concat(w(t.id),": ").concat(g.g(".1f")(r(t)),"/1000 population")}),g.v(".selected").classed("selected",!1),t.forEach(function(t,e){g.u("path#"+t).style("fill",b.selection[e%y]).classed("selected",!0)}),q.update(),N.update()}n(172),n(174),n(176);var _={1995:"1995",2000:"2000",2005:"2005",2010:"2010",2015:"2015",2017:"2017"};function tt(t){c.a.set("year",t),V.update()}var et=function(t){function e(){return Object(d.a)(this,e),Object(p.a)(this,Object(h.a)(e).apply(this,arguments))}return Object(v.a)(e,t),Object(f.a)(e,[{key:"render",value:function(){return i.a.createElement("div",{style:{padding:"0.4em 2em 0"}},i.a.createElement(m.a,{min:1995,max:2017,included:!1,marks:_,step:null,onChange:tt,defaultValue:2010,handleStyle:{border:"white",backgroundColor:"silver"}}))}}]),e}(i.a.PureComponent),nt=n(68),rt=n(96),at=n(98),ct=n.n(at),ot=function(t){function e(){return Object(d.a)(this,e),Object(p.a)(this,Object(h.a)(e).apply(this,arguments))}return Object(v.a)(e,t),Object(f.a)(e,[{key:"render",value:function(){var t=this.props.countries.sort(function(t,e){return t.label<e.label?-1:1});return i.a.createElement(rt.a,Object.assign({isMulti:!0,placeholder:"Select countries...",components:ct.a,onBlurResetsInput:!1,onSelectResetsInput:!1,onCloseResetsInput:!1,options:t,theme:function(t){return Object(nt.a)({},t,{borderRadius:0,colors:Object(nt.a)({},t.colors,{neutral0:"#333",neutral5:"orange",neutral10:"#666",neutral20:"#666",primary25:"#666",neutral50:"#eee",neutral80:"white"})})}},this.props))}}]),e}(i.a.PureComponent),it=n(38),ut=n(99),lt=n.n(ut),st=function(t){function e(t){var n;return Object(d.a)(this,e),(n=Object(p.a)(this,Object(h.a)(e).call(this,t))).state={checked:!1},n.handleChange=n.handleChange.bind(Object(it.a)(Object(it.a)(n))),n}return Object(v.a)(e,t),Object(f.a)(e,[{key:"componentDidMount",value:function(){var t=this.state.checked;c.a.set("isEmigration",t)}},{key:"handleChange",value:function(t){c.a.set("isEmigration",t),this.setState({checked:t}),V.update()}},{key:"render",value:function(){var t=this.state.checked;return i.a.createElement("div",null,i.a.createElement(lt.a,{onChange:this.handleChange,checked:t,onColor:"#FFCC80",offColor:"#FFAB91",onHandleColor:"#FFB74D",offHandleColor:"#FF8A65",handleDiameter:24,uncheckedIcon:!1,checkedIcon:!1,boxShadow:"0px 1px 5px rgba(0, 0, 0, 0.6)",activeBoxShadow:"0px 0px 1px 10px rgba(0, 0, 0, 0.2)",height:16,width:64,id:"mySwitcherino"}),i.a.createElement("span",null,t?"Emigration":"Immigration"))}}]),e}(i.a.Component);n(200);c.a.remove("selectedCountries"),c.a.remove("isEmigration"),c.a.set("selectedCountries",["PRT","ESP","FRA","DEU"]);var dt=[Object(s.a)("./data/topology.json"),Object(s.a)("./data/migrations.json"),Object(s.b)("./data/conversion.tsv"),Object(s.b)("./data/population.tsv"),Object(s.b)("./data/whr2018.tsv")];Promise.all(dt).then(function(t){return function(t){var e=Object(r.a)(t,5),n=e[0],a=e[1],o=e[2],u=e[3],s=e[4],d=function(t){function e(t,e){var n=t.indexOf(e);return n>0?t[n-1]:t[0]}var n={},r=Object.keys(t);for(var a in t)if(a!==r[0])for(var c in n[a]={},t[a])for(var o in n[a][c]={},t[a][c]){var i=t[a][c],u=t[e(r,a)][c]||{};n[a][c][o]=i[o]-(u[o]||0)}return n}(a),f={},p={},h={};u.forEach(function(t){return p[t.Country]=j(t)}),s.forEach(function(t){return h[t.country]=j(t)}),o.forEach(function(t){return f[t.code3]=t.name}),c.a.set("codeToName",f),N.draw("#chord",a),q.draw("#graph",d,s,p),V.draw("#map",n,d,p),l.a.render(function(t,e){var n=[];return Object.keys(t[2e3]).forEach(function(t){3===t.length&&n.push({value:t,label:e[t]})}),i.a.createElement(ot,{countries:n,onChange:function(t){var e=new Set(c.a.get("selectedCountries"));t.forEach(function(t){return e.add(t.value)}),c.a.set("selectedCountries",Array.from(e)),V.update()}})}(d,f),A("countrySelect")),l.a.render(i.a.createElement(st,null),A("migrationSwitch")),l.a.render(i.a.createElement(et,null),A("yearSlider"))}(t)})}},[[102,2,1]]]);
//# sourceMappingURL=main.46c1346e.chunk.js.map